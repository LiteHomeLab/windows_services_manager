<Window x:Class="WinServiceManager.Views.CreateServiceDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:converters="clr-namespace:WinServiceManager.Converters"
        mc:Ignorable="d"
        Title="åˆ›å»ºæ–°æœåŠ¡"
        Height="900" Width="800"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Background="#F0F0F0">

    <Window.Resources>
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter"/>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>

        <!-- DataGridæ–‡æœ¬æ ·å¼ -->
        <Style x:Key="DataGridTextCellStyle" TargetType="TextBlock">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>
    </Window.Resources>

  <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="20"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="20"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="20"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="20"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="20"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="20"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="20"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="20"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="20"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- æœåŠ¡ä¿¡æ¯ç»„ -->
        <GroupBox Grid.Row="0" Header="æœåŠ¡ä¿¡æ¯" Padding="15" Background="White">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="15"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" Orientation="Horizontal">
                    <TextBlock Text="æœåŠ¡åç§°:" Width="90" VerticalAlignment="Center" Foreground="#333"/>
                    <TextBox Width="350"
                             Text="{Binding DisplayName, UpdateSourceTrigger=PropertyChanged}"
                             Padding="5"/>
                    <TextBlock Text="*" Foreground="Red" Margin="5,0,0,0" VerticalAlignment="Center" FontSize="14"/>
                </StackPanel>

                <StackPanel Grid.Row="2" Orientation="Horizontal">
                    <TextBlock Text="æè¿°:" Width="90" VerticalAlignment="Top" Foreground="#333" Margin="0,5,0,0"/>
                    <TextBox Width="350"
                             Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}"
                             Height="60"
                             TextWrapping="Wrap"
                             VerticalScrollBarVisibility="Auto"
                             AcceptsReturn="True"
                             Padding="5"/>
                </StackPanel>
            </Grid>
        </GroupBox>

        <!-- æ‰§è¡Œé…ç½®ç»„ -->
        <GroupBox Grid.Row="2" Header="æ‰§è¡Œé…ç½®" Padding="15" Background="White">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="12"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="12"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="12"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- å¯æ‰§è¡Œæ–‡ä»¶ -->
                <StackPanel Grid.Row="0" Orientation="Horizontal">
                    <TextBlock Text="å¯æ‰§è¡Œæ–‡ä»¶:" Width="90" VerticalAlignment="Center" Foreground="#333"/>
                    <TextBox Width="320"
                             Text="{Binding ExecutablePath, UpdateSourceTrigger=PropertyChanged}"
                             Padding="5"
                             IsReadOnly="{Binding IsBusy}"/>
                    <Button Content="æµè§ˆ..."
                            Command="{Binding BrowseExecutableCommand}"
                            Width="60"
                            Margin="8,0,0,0"
                            Padding="5"/>
                    <TextBlock Text="*" Foreground="Red" Margin="5,0,0,0" VerticalAlignment="Center" FontSize="14"/>
                </StackPanel>

                <!-- è„šæœ¬æ–‡ä»¶ -->
                <StackPanel Grid.Row="2" Orientation="Horizontal">
                    <TextBlock Text="è„šæœ¬æ–‡ä»¶:" Width="90" VerticalAlignment="Center" Foreground="#333"/>
                    <TextBox Width="320"
                             Text="{Binding ScriptPath, UpdateSourceTrigger=PropertyChanged}"
                             Padding="5"
                             IsEnabled="{Binding IsScriptFileEnabled}"
                             IsReadOnly="{Binding IsBusy}"/>
                    <Button Content="æµè§ˆ..."
                            Command="{Binding BrowseScriptCommand}"
                            Width="60"
                            Margin="8,0,0,0"
                            Padding="5"
                            IsEnabled="{Binding IsScriptFileEnabled}"/>
                </StackPanel>

                <!-- å¯åŠ¨å‚æ•° -->
                <StackPanel Grid.Row="4" Orientation="Horizontal" VerticalAlignment="Top">
                    <TextBlock Text="å¯åŠ¨å‚æ•°:" Width="90" VerticalAlignment="Center" Foreground="#333" Margin="0,5,0,0"/>
                    <TextBox Width="320"
                             Text="{Binding Arguments, UpdateSourceTrigger=PropertyChanged}"
                             Height="50"
                             TextWrapping="Wrap"
                             VerticalScrollBarVisibility="Auto"
                             AcceptsReturn="True"
                             Padding="5"
                             IsReadOnly="{Binding IsBusy}"/>
                </StackPanel>

                <!-- å·¥ä½œç›®å½• -->
                <StackPanel Grid.Row="6" Orientation="Horizontal">
                    <TextBlock Text="å·¥ä½œç›®å½•:" Width="90" VerticalAlignment="Center" Foreground="#333"/>
                    <TextBox Width="320"
                             Text="{Binding WorkingDirectory, UpdateSourceTrigger=PropertyChanged}"
                             Padding="5"
                             IsReadOnly="{Binding IsBusy}"/>
                    <Button Content="æµè§ˆ..."
                            Command="{Binding BrowseWorkingDirectoryCommand}"
                            Width="60"
                            Margin="8,0,0,0"
                            Padding="5"/>
                    <TextBlock Text="*" Foreground="Red" Margin="5,0,0,0" VerticalAlignment="Center" FontSize="14"/>
                </StackPanel>
            </Grid>
        </GroupBox>

        <!-- ä¾èµ–æœåŠ¡é…ç½® -->
        <GroupBox Grid.Row="4" Header="ä¾èµ–æœåŠ¡é…ç½®" Padding="15" Background="White">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="150"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" Orientation="Horizontal">
                    <TextBlock Text="é€‰æ‹©æ­¤æœåŠ¡ä¾èµ–çš„å…¶ä»–æœåŠ¡:"
                               Foreground="#333" FontWeight="Medium" VerticalAlignment="Center"/>
                    <TextBlock Text="ï¼ˆé€‰ä¸­çš„æœåŠ¡å°†åœ¨æ­¤æœåŠ¡å¯åŠ¨å‰è‡ªåŠ¨å¯åŠ¨ï¼‰"
                               Foreground="#666" FontSize="11" Margin="15,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>

                <Border Grid.Row="2"
                        BorderBrush="#DDD"
                        BorderThickness="1"
                        CornerRadius="3"
                        Background="White">
                    <ListBox ItemsSource="{Binding AvailableServices}"
                             ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                             ScrollViewer.VerticalScrollBarVisibility="Auto"
                             Padding="5"
                             MaxHeight="140">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="3">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <CheckBox Grid.Column="0"
                                              IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                              Content="{Binding DisplayName}"
                                              VerticalAlignment="Center"
                                              FontWeight="Medium"
                                              ToolTip="{Binding Description}"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding Status}"
                                               VerticalAlignment="Center"
                                               FontSize="11"
                                               Foreground="#666"
                                               Margin="10,0,0,0"/>
                                </Grid>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="ListBoxItem">
                                            <ContentPresenter/>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="Padding" Value="0"/>
                            </Style>
                        </ListBox.ItemContainerStyle>
                    </ListBox>
                </Border>

                <!-- ä¾èµ–æç¤ºä¿¡æ¯ -->
                <TextBlock Grid.Row="2"
                           Text="ðŸ’¡ é€‰æ‹©ä¾èµ–æœåŠ¡æ—¶è¯·ç¡®ä¿ä¸ä¼šå½¢æˆå¾ªçŽ¯ä¾èµ–"
                           Foreground="#2196F3"
                           FontSize="11"
                           VerticalAlignment="Bottom"
                           HorizontalAlignment="Center"
                           Margin="0,140,0,0"
                           Visibility="{Binding HasDependencies, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            </Grid>
        </GroupBox>

        <!-- æœåŠ¡è´¦æˆ·é…ç½® -->
        <GroupBox Grid.Row="6" Header="æœåŠ¡è´¦æˆ·é…ç½®" Padding="15" Background="White">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="12"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="12"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="12"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="90"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- å¯åŠ¨æ¨¡å¼ -->
                <TextBlock Grid.Row="0" Grid.Column="0" Text="å¯åŠ¨æ¨¡å¼:" VerticalAlignment="Center" Foreground="#333"/>
                <ComboBox Grid.Row="0" Grid.Column="1"
                          SelectedValue="{Binding StartMode}"
                          Padding="5"
                          IsEnabled="{Binding IsBusy, Converter={StaticResource InverseBooleanConverter}}">
                    <ComboBoxItem Content="Automatic"/>
                    <ComboBoxItem Content="Manual"/>
                    <ComboBoxItem Content="Disabled"/>
                </ComboBox>

                <!-- æœåŠ¡è´¦æˆ· -->
                <TextBlock Grid.Row="2" Grid.Column="0" Text="æœåŠ¡è´¦æˆ·:" VerticalAlignment="Center" Foreground="#333"/>
                <StackPanel Grid.Row="2" Grid.Column="1" Orientation="Horizontal">
                    <TextBox Width="250"
                             Text="{Binding ServiceAccount, UpdateSourceTrigger=PropertyChanged}"
                             Padding="5"
                             IsReadOnly="{Binding IsBusy}"/>
                    <Button Content="å»ºè®®è´¦æˆ·"
                            Command="{Binding SuggestServiceAccountCommand}"
                            Width="80"
                            Margin="8,0,0,0"
                            Padding="5"
                            IsEnabled="{Binding IsBusy, Converter={StaticResource InverseBooleanConverter}}"/>
                </StackPanel>

                <!-- åœæ­¢è¶…æ—¶ -->
                <TextBlock Grid.Row="4" Grid.Column="0" Text="åœæ­¢è¶…æ—¶:" VerticalAlignment="Center" Foreground="#333"/>
                <StackPanel Grid.Row="4" Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBox Width="100"
                             Text="{Binding StopTimeout, UpdateSourceTrigger=PropertyChanged}"
                             Padding="5"
                             IsReadOnly="{Binding IsBusy}"/>
                    <TextBlock Text="æ¯«ç§’" Foreground="#666" Margin="8,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>

                <!-- æœåŠ¡é€‰é¡¹ -->
                <StackPanel Grid.Row="6" Grid.Column="0" Grid.ColumnSpan="3" Orientation="Horizontal">
                    <CheckBox Content="åˆ›å»ºåŽè‡ªåŠ¨å¯åŠ¨æœåŠ¡"
                              IsChecked="{Binding AutoStart}"
                              IsEnabled="{Binding IsBusy, Converter={StaticResource InverseBooleanConverter}}"
                              Margin="0,5,15,5"/>
                    <CheckBox Content="æœåŠ¡å¤±è´¥æ—¶è‡ªåŠ¨é‡å¯"
                              IsChecked="{Binding AutoRestart}"
                              IsEnabled="{Binding IsBusy, Converter={StaticResource InverseBooleanConverter}}"
                              Margin="0,5"/>
                </StackPanel>
            </Grid>
        </GroupBox>

        <!-- çŽ¯å¢ƒå˜é‡é…ç½® -->
        <GroupBox Grid.Row="7" Header="çŽ¯å¢ƒå˜é‡é…ç½®" Padding="15" Background="White">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="120"/>
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" Orientation="Horizontal">
                    <TextBlock Text="çŽ¯å¢ƒå˜é‡:" Foreground="#333" FontWeight="Medium" VerticalAlignment="Center"/>
                    <TextBlock Text="ï¼ˆä¸ºæœåŠ¡è¿è¡Œæ—¶æä¾›çš„çŽ¯å¢ƒå˜é‡ï¼‰" Foreground="#666" FontSize="11" Margin="10,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>

                <Border Grid.Row="2"
                        BorderBrush="#DDD"
                        BorderThickness="1"
                        CornerRadius="3"
                        Background="White">
                    <DataGrid x:Name="EnvironmentVariablesDataGrid"
                              ItemsSource="{Binding EnvironmentVariables}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="True"
                              CanUserDeleteRows="True"
                              GridLinesVisibility="Horizontal"
                              HorizontalGridLinesBrush="#F0F0F0"
                              HeadersVisibility="Column"
                              RowBackground="White"
                              AlternatingRowBackground="#FAFAFA"
                              IsEnabled="{Binding IsBusy, Converter={StaticResource InverseBooleanConverter}}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="å˜é‡å" Width="150"
                                                Binding="{Binding Key, UpdateSourceTrigger=PropertyChanged}"
                                                ElementStyle="{StaticResource DataGridTextCellStyle}"/>
                            <DataGridTextColumn Header="å˜é‡å€¼" Width="*"
                                                Binding="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                                                ElementStyle="{StaticResource DataGridTextCellStyle}"/>
                            <DataGridTemplateColumn Header="æ“ä½œ" Width="80">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="åˆ é™¤"
                                                Command="{Binding DataContext.RemoveEnvironmentVariableCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                CommandParameter="{Binding}"
                                                Background="#F44336"
                                                Foreground="White"
                                                BorderThickness="0"
                                                Padding="8,4"
                                                FontSize="11"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Border>

                <StackPanel Grid.Row="4" Orientation="Horizontal">
                    <Button Content="æ·»åŠ å¸¸ç”¨å˜é‡"
                            Command="{Binding AddCommonEnvironmentVariablesCommand}"
                            Width="120"
                            Height="30"
                            Background="#2196F3"
                            Foreground="White"
                            BorderThickness="0"
                            Margin="0,0,10,0"/>
                    <Button Content="æ¸…ç©ºæ‰€æœ‰"
                            Command="{Binding ClearEnvironmentVariablesCommand}"
                            Width="80"
                            Height="30"
                            Background="#FF9800"
                            Foreground="White"
                            BorderThickness="0"/>
                </StackPanel>
            </Grid>
        </GroupBox>

        <!-- é”™è¯¯ä¿¡æ¯ -->
        <Border Grid.Row="9"
                Background="#FFEBEE"
                BorderBrush="#F44336"
                BorderThickness="1"
                CornerRadius="3"
                Padding="10"
                Visibility="{Binding ErrorMessage, Converter={StaticResource StringToVisibilityConverter}}">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="âš " Foreground="#F44336" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                <TextBlock Text="{Binding ErrorMessage}"
                           Foreground="#C62828"
                           TextWrapping="Wrap"
                           VerticalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- é…ç½®é¢„è§ˆ -->
        <GroupBox Grid.Row="11" Header="é…ç½®é¢„è§ˆ" Padding="15" Background="White" Visibility="{Binding ShowPreview, Converter={StaticResource BooleanToVisibilityConverter}}">
            <ScrollViewer Height="120" VerticalScrollBarVisibility="Auto">
                <TextBlock Text="{Binding ConfigPreview}"
                           FontFamily="Consolas"
                           FontSize="11"
                           Background="#F5F5F5"
                           Padding="10"/>
            </ScrollViewer>
        </GroupBox>

        <!-- æŒ‰é’®åŒºåŸŸ -->
        <StackPanel Grid.Row="14"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0,15,0,0">
            <Button Content="é¢„è§ˆé…ç½®"
                    Command="{Binding PreviewConfigCommand}"
                    Width="100"
                    Height="35"
                    Margin="0,0,10,0"
                    Background="#FF9800"
                    Foreground="White"/>
            <Button Content="åˆ›å»º"
                    Command="{Binding CreateCommand}"
                    IsEnabled="{Binding CanCreate}"
                    Width="80"
                    Height="35"
                    Margin="0,0,10,0"
                    Background="#4CAF50"
                    Foreground="White"/>
            <Button Content="å–æ¶ˆ"
                    Command="{Binding CancelCommand}"
                    Width="80"
                    Height="35"
                    Background="#757575"
                    Foreground="White"/>
        </StackPanel>
    </Grid>
</Window>