# WinServiceManager 测试示例

## 测试服务文件

本目录包含用于测试 WinServiceManager 功能的示例服务。

### 1. Python测试服务 (simple-test-service.py)

这是一个简单的Python服务，用于测试应用程序的功能：

```python
# 功能：
# - 每5秒输出一次时间戳
# - 记录运行日志
# - 计数器统计运行次数
# - 异常处理和优雅退出
```

**测试步骤：**
1. 确保系统安装了Python 3.6+
2. 在WinServiceManager中创建新服务
3. 选择可执行文件：`python.exe`
4. 设置参数：`simple-test-service.py`
5. 设置工作目录：包含此文件的目录

### 2. 批处理测试服务 (simple-test-service.bat)

这是一个简单的批处理服务，不需要额外依赖：

```batch
# 功能：
# - 每5秒输出时间戳和计数器
# - 每10次循环输出状态报告
# - 持续运行直到手动停止
```

**测试步骤：**
1. 在WinServiceManager中创建新服务
2. 选择可执行文件：`cmd.exe`
3. 设置参数：`/c simple-test-service.bat`
4. 设置工作目录：包含此文件的目录

## 测试用例

### 基本功能测试

1. **服务创建测试**
   - ✅ 输入服务名称和描述
   - ✅ 选择可执行文件路径
   - ✅ 配置启动参数和工作目录
   - ✅ 设置环境变量（可选）

2. **服务管理测试**
   - ✅ 安装服务到系统
   - ✅ 启动服务并验证运行状态
   - ✅ 停止服务并验证停止状态
   - ✅ 重启服务并验证重新运行
   - ✅ 卸载服务并清理资源

3. **日志查看测试**
   - ✅ 查看服务输出日志
   - ✅ 查看服务错误日志
   - ✅ 实时日志更新
   - ✅ 日志过滤和搜索功能

4. **安全功能测试**
   - ✅ 路径遍历防护：尝试输入`../../windows/system32`路径
   - ✅ 命令注入防护：尝试输入`&calc.exe`等危险命令
   - ✅ 管理员权限检查：非管理员运行时提示错误

### 高级功能测试

1. **服务配置测试**
   - ✅ 服务启动模式：自动/手动/禁用
   - ✅ 服务依赖关系
   - ✅ 环境变量配置
   - ✅ 工作目录设置

2. **性能测试**
   - ✅ 同时管理多个服务
   - ✅ 长时间运行稳定性
   - ✅ 内存使用情况监控
   - ✅ CPU使用情况监控

## 测试脚本

### 自动化测试脚本

创建一个简单的测试脚本来自动化验证功能：

```batch
@echo off
echo ========================================
echo WinServiceManager 自动化测试
echo ========================================

REM 测试1：检查应用程序是否可以启动
echo 测试1：启动应用程序...
start "" "src\WinServiceManager\bin\Debug\net8.0-windows\WinServiceManager.exe"
timeout /t 5

REM 测试2：创建测试服务
echo 测试2：创建测试服务...
REM 这里需要手动操作或使用UI自动化工具

REM 测试3：验证服务功能
echo 测试3：验证服务功能...

echo 自动化测试完成
pause
```

## 预期结果

### 成功场景

1. **服务创建成功**
   - 服务出现在服务列表中
   - 服务状态显示为"已安装"或"已停止"
   - 服务配置正确保存

2. **服务运行成功**
   - 服务状态显示为"运行中"
   - 日志文件正常创建和更新
   - 服务输出正常显示

3. **服务管理成功**
   - 启动/停止操作正常执行
   - 服务状态正确更新
   - 系统服务列表中可以找到服务

### 故障场景

1. **权限不足**
   - 非管理员运行时显示权限错误
   - 无法创建或管理服务

2. **路径错误**
   - 可执行文件不存在时显示错误
   - 工作目录不存在时显示错误

3. **配置错误**
   - 参数格式错误时显示提示
   - 环境变量格式错误时显示提示

## 故障排除

### 常见问题

1. **服务无法启动**
   - 检查可执行文件路径是否正确
   - 检查工作目录是否存在
   - 检查启动参数是否正确
   - 查看错误日志获取详细信息

2. **日志无法查看**
   - 确认服务已经运行过
   - 检查日志文件权限
   - 确认日志文件路径正确

3. **服务卸载失败**
   - 确认服务已停止
   - 检查是否有其他进程在使用服务
   - 查看系统事件日志获取错误信息

### 调试技巧

1. **启用详细日志**
   ```bash
   dotnet run --project src/WinServiceManager --verbosity diagnostic
   ```

2. **检查系统服务**
   - 打开 `services.msc`
   - 查找以 `WinServiceManager_` 开头的服务
   - 检查服务状态和属性

3. **检查文件系统**
   - 查看 `services/` 目录
   - 检查服务配置文件
   - 查看日志文件内容

## 测试报告

测试完成后，记录以下信息：

1. **测试环境**
   - 操作系统版本
   - .NET 版本
   - WinSW 版本
   - 测试服务类型

2. **测试结果**
   - 通过的功能测试
   - 失败的功能测试
   - 发现的问题和错误
   - 性能指标

3. **建议改进**
   - 功能完善建议
   - 用户体验改进
   - 安全性增强建议

## 贡献

如果您发现了问题或有改进建议，请：

1. 在GitHub上创建Issue
2. 提供详细的测试步骤和结果
3. 附上相关的日志文件和截图
4. 建议解决方案或改进方向