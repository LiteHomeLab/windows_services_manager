# 测试指南

## 运行要求

1. **管理员权限**：必须以管理员身份运行应用程序
2. **.NET 8 Runtime**：确保已安装 .NET 8 运行时
3. **WinSW 文件**：确保 `templates/WinSW-x64.exe` 文件存在

## 测试步骤

### 1. 编译项目

```bash
cd src
dotnet build
```

### 2. 运行应用程序

```bash
# 以管理员身份运行
dotnet run --project WinServiceManager
```

### 3. 测试创建服务

#### 使用 Python 脚本测试

1. 点击"创建服务"按钮
2. 填写服务信息：
   - 服务名称：`Python测试服务`
   - 描述：`用于测试的Python服务`
   - 可执行文件：选择 Python 解释器（如 `C:\Python311\python.exe`）
   - 脚本文件：选择 `test_service.py`
   - 工作目录：选择项目根目录
   - 启动参数：留空
3. 点击"预览配置"查看生成的 WinSW 配置
4. 点击"创建"按钮

#### 使用批处理文件测试

1. 点击"创建服务"按钮
2. 填写服务信息：
   - 服务名称：`批处理测试服务`
   - 描述：`用于测试的批处理服务`
   - 可执行文件：选择 `test_service.bat`
   - 工作目录：选择项目根目录
3. 点击"创建"按钮

### 4. 验证服务

1. **在应用程序中查看**：
   - 服务应该出现在列表中
   - 状态应该显示为"已停止"或"运行中"

2. **在 Windows 服务管理器中查看**：
   - 按 `Win + R`，输入 `services.msc`
   - 查找创建的服务（名称通常是 DisplayName 或 ID）

3. **启动服务**：
   - 在应用程序中选中服务，点击"启动"按钮
   - 或在 services.msc 中右键选择"启动"

4. **查看日志**：
   - 选中服务，点击"查看日志"按钮
   - 切换输出日志和错误日志
   - 启用实时监控查看日志更新

5. **停止服务**：
   - 点击"停止"按钮
   - 验证进程是否被正确终止

6. **重启服务**：
   - 点击"重启"按钮
   - 验证服务停止后重新启动

7. **卸载服务**：
   - 先停止服务
   - 点击"卸载"按钮
   - 确认操作
   - 验证服务从列表和 services.msc 中消失

### 5. 测试异常场景

#### 错误的文件路径

1. 创建服务时输入不存在的可执行文件路径
2. 应该显示错误消息，不允许创建

#### 无效的参数

1. 在启动参数中输入特殊字符如 `& | < >`
2. 参数应该被自动清理或显示警告

#### 权限不足

1. 尝试以普通用户身份运行
2. 应该显示需要管理员权限的警告

## 日志文件位置

- 服务日志：`services/{ServiceID}/logs/{ServiceID}.out.log`
- 错误日志：`services/{ServiceID}/logs/{ServiceID}.err.log`
- 应用程序日志：根据配置，可能在事件查看器或指定位置

## 常见问题

### Q: 创建服务失败
**A**: 检查：
- 是否以管理员身份运行
- WinSW.exe 是否存在
- 路径是否有效

### Q: 服务启动失败
**A**: 查看：
- 错误日志文件
- Windows 事件查看器
- 服务配置是否正确

### Q: 日志查看器没有内容
**A**: 确保：
- 服务正在运行
- 日志文件路径正确
- 刷新日志查看器

## 开发者注意事项

1. **调试模式**：可以在 App.xaml.cs 中禁用管理员权限检查以便调试
2. **临时文件**：服务配置和日志存储在 `services` 目录下
3. **清理**：测试完成后记得删除创建的服务